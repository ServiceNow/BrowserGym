from hatchling.builders.hooks.plugin.interface import BuildHookInterface
import subprocess
import pathlib

class NodeModulesBuildHook(BuildHookInterface):
    def initialize(self, version, build_data):
        package_dir = "src/browsergym/subtaskbench/package"

        # Remove any existing package-lock.json to avoid conflicts
        package_lock = pathlib.Path(package_dir) / "package-lock.json"
        if package_lock.exists():
            package_lock.unlink()

        subprocess.run(["yarn", "install"], cwd=package_dir, check=True)
